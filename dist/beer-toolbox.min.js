angular.module("BeerToolbox",[]),angular.module("BeerToolbox").service("BeerColor",["UnitsConversion",function(a){"use strict";this.estimateColor=function(b,c){var d,e=0;c.forEach(function(c){d=a.fromTo(c.color,"color.ebc","color.lovibond"),e+=8.34540445202*d*(c.massGr/1e3)/b});var f=1.4922*Math.pow(e,.6859),g=a.fromTo(f,"color.srm","color.rgb");return{srm:f,rgb:g}}}]),angular.module("BeerToolbox").service("BeerSugar",["Polynome",function(a){var b=new a({a3:182.4601,a2:-775.6821,a1:1262.7794,a0:-669.5622}),c=new a({a3:135.997,a2:-630.272,a1:1111.14,a0:-616.868});this.densityCorrection=function(a,b,c){return c="undefined"==typeof c?20:c,(a-(c+288.9414)/(508929.2*(c+68.12963))*Math.pow(c-3.9863,2))/(1-(b+288.9414)/(508929.2*(b+68.12963))*Math.pow(b-3.9863,2))},this.gravityToAlcohol=function(a,b,c){return calibrationTemp=calibrationTemp?calibrationTemp:0,1.05*(a-b)/b*100/.795+5e-4*c/.795/10},this.gravityDilution=function(a,b,c,d){d="undefined"==typeof d||0>c?1:d;var e=a+c;return(b*a+d*c)/e},this.mashingVolume=function(a,b){return("undefined"==typeof b?3:b)*a},this.grainRetention=function(a,b){return("undefined"==typeof b?1:b)*a},this.volumeToBoil=function(a,b,c){return b="undefined"==typeof b?.1:b,c="undefined"==typeof c?.05:c,a/((1-b)*(1-c))},this.producedSugar=function(a,b){return b="undefined"==typeof b?.75:b,b*[0].concat(malt).reduce(function(a,b){return a+b.mass*b.yield_m})},this.brixToSg=function(a){return b.invert(a)},this.sgToBrix=function(a){return b.direct(brix)},this.platoToSg=function(a){return c.invert(a)},this.sgToPlato=function(a){return c.direct(a)},this.sgToAlcohol=function(a){return alcohol/.0076},this.alcoholToSg=function(a){return.0076*a},this.sgToAlcohol=function(a,b){return"undefined"==typeof b&&(b=1+(a-1)/4),(a-b)/.0076},this.diluateSugar=function(a,b,c){c="undefined"==typeof c?.25:c;var d=0!==a?100*b/a:0,e=brixToSg(d),f=1+(e-1)*c,g=sgToAlcohol(e,f),h=sgToPlato(e);return{brixGravity:d,specificGravity:e,residualGravity:f,platoGravity:h,alcohol:g}}}]),angular.module("BeerToolbox").service("Ibu",function(){"use strict";var a={rager:function(a,b,c,d,e){var f=d>1.05?(d-1.05)/.2:0,g=18.109069+13.862039*Math.tanh((e-31.322749)/18.267743);return b*g*a*1e3/(c*(1+f))},tinseth:function(a,b,c,d,e){var f=1.65*Math.pow(125e-6,d-1),g=(1-Math.exp(-.04*e))/4.15,h=f*g;return b*h*a*1e3/c}};this.availableMethods=function(){return Object.keys(a)},this.compute=function(b,c,d){d=angular.extend({precision:null},d);var e=[0].concat(c).reduce(function(c,d){var e=/^pellet/.test(d.type?d.type:"")?1.1:1;return c+a[b](e*d.alphaAcidity/100,d.massGr,d.volumeL,d.gravitySg,d.lastingMin)});if(d.precision&&"number"==typeof e){var f=Math.pow(10,d.precision);return Math.round(e*f)/f}return e}}),angular.module("BeerToolbox").service("Polynome",function(){"use strict";var a=function(a){var b=this;this.polynomeObj={};var c=[0];Object.keys(a).forEach(function(d){var e=d.match(/[a-zA-Z_\.\-]*(\d+)/);if(e){var f=parseInt(e[1],10);c.push(f),b.polynomeObj[f]=parseFloat(a[d])}}),this.size=Math.max.apply(null,c)+1};a.prototype.solveEq=function(a){switch(this.size){case 1:return[];case 2:return b(this.polynomeObj,a);case 3:return c(this.polynomeObj,a);case 4:return d(this.polynomeObj,a);default:return[]}},a.prototype.invert=function(a){var b=this.solveEq(a);return b.length?b[0]:null},a.prototype.direct=function(a){var b=this,c=0;return Object.keys(this.polynomeObj).forEach(function(d){c+=b.polynomeObj[d]*Math.pow(a,d)}),c};var b=function(a,b){return a[1]?[(b-(a[0]?a[0]:0))/a[1]]:[]},c=function(a,b){var c=Math.pow(a[1],2)-4*(a[0]-b)*a[2];return 0>c?[]:0===c?[-a[1]/(2*a[2])]:c>0?[(-a[1]+Math.sqrt(c))/(2*a[2]),(-a[1]-Math.sqrt(c))/(2*a[2])]:void 0},d=function(a,b){if(0===a[3])return c(equ,b);if(0===a[1]&&0===a[2])return sol[0]=1,[-Math.pow((a[0]-b)/a[3],1/3)];var d=(a[0]-b)/a[3],e=a[1]/a[3],f=a[2]/a[3],g=f/3,h=e-g*f,i=d-e*g+2*Math.pow(g,3),j=Math.pow(i/2,2)+Math.pow(h/3,3);if(j>0){var k=Math.pow(-i/2+Math.sqrt(j),1/3);return[k-h/(3*k)-g]}if(0===j)return[3*i/h-g,-3*i/(2*h)-g,-3*i/(2*h)-g];if(0>j){var l=2*Math.sqrt(-h/3),m=-i/(2*Math.pow(-h/3,1.5)),n=Math.acos(m)/3;return[l*Math.cos(n)-g,l*Math.cos(n+2*Math.PI/3)-g,l*Math.cos(n+4*Math.PI/3)-g]}};return a}),angular.module("BeerToolbox").service("UnitsConversion",["Polynome",function(a){"use strict";var b=/(([\w-]*)\.)?(.*)/;this.data={temperature:{celcius:new a({a0:-273.15,a1:1}),fahrenheit:new a({a0:-459.67,a1:1.8}),kelvin:new a({a1:1})},color:{ebc:new a({a1:1}),srm:new a({a1:1/1.97}),lovibond:new a({a0:.561051,a1:.374734}),mcu:{direct:function(a){return a/1.97>=10?3.5*(a/1.97-50/7):10-Math.sqrt(100-5.0761421*a)},invert:function(a){return a>=10?3.94*(a+25)/7:(100-Math.pow(10-a,2))/5.0761421}},rgb:{direct:function(a){var b=function(a){var b="00"+a.toString(16);return b.substring(b.length-2)},c=Math.round(Math.min(255,Math.max(0,255*Math.pow(.975,a/1.97)))),d=Math.round(Math.min(255,Math.max(0,245*Math.pow(.88,a/1.97)))),e=Math.round(Math.min(255,Math.max(0,220*Math.pow(.7,a/1.97))));return"#"+b(c)+b(d)+b(e)},invert:function(a){return 0}}},sugar:{plato:new a({a3:135.997,a2:-630.272,a1:1111.14,a0:-616.868}),brix:new a({a3:182.4601,a2:-775.6821,a1:1262.7794,a0:-669.5622}),alcohol:new a({a1:1/.76,a0:-1/.76}),sg:new a({a1:1}),gPerLiter:new a({a3:1824.601,a2:-7756.821,a1:12627.794,a0:-6695.622})},mass:{kg:new a({a1:1}),g:new a({a1:1e3}),t:new a({a1:.001}),mg:new a({a1:1e6})},volume:{l:new a({a1:1}),ml:new a({a1:1e3}),dl:new a({a1:10}),cl:new a({a1:100}),dm3:new a({a1:1}),m3:new a({a1:.001}),cm3:new a({a1:1e3}),mm3:new a({a1:1e6}),"gal-us":new a({a1:.22}),"gal-en":new a({a1:.264}),pinte:new a({a1:1.76})}},this.fromTo=function(a,c,d,e){var f=function(a,b){this.origin=a,this.message=b},g=c.match(b),h=d.match(b),i=h[3],j=g[3];if(a="string"==typeof a?parseFloat(a):a,e=angular.extend({type:g[2],precision:null},e),!this.data[e.type])throw new f("from","Type "+e.type+" does not exist in the unit conversion system");if(!this.data[e.type][j])throw new f("from","Unit "+j+" does not exist for type "+e.type);if(!this.data[e.type][i])throw new f("to","Unit "+i+" does not exist for type "+e.type);var k=this.data[e.type][j].invert(a);if("number"!=typeof k)throw new f("from","Value "+a+" is out of bounce in unit "+j+", type "+e.type);var l=this.data[e.type][i].direct(k);if(e.precision&&"number"==typeof l){var m=Math.pow(10,e.precision);return Math.round(l*m)/m}return l},this.getPhysicalUnits=function(){var a=this;return Object.keys(this.data).map(function(b){return{type:b,units:Object.keys(a.data[b]).map(function(a){return{name:a,id:b+"."+a}})}})},this.registerConversion=function(c,d,e){var f=d.match(b);if(f){f[3];e=e?e:f[2],this.prototype.data[e]=angular.extend({},this.prototype.data[e]),this.prototype.data[e][thisUnit]=new a(c)}}}]);